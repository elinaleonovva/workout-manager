{"ast":null,"code":"var _jsxFileName = \"D:\\\\\\u041C\\u0418\\u0420\\u042D\\u0410\\\\workout-manager\\\\fitness-client\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useState, useEffect, useCallback } from 'react';\nimport { getRefreshToken, setRefreshToken, removeRefreshToken, getAccessToken, setAccessToken, removeAccessToken } from '../utils/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [accessToken, setAccessTokenState] = useState(getAccessToken());\n  const [refreshToken, setRefreshTokenState] = useState(getRefreshToken());\n  const [user, setUser] = useState(null);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const setTokens = (access, refresh) => {\n    setAccessTokenState(access);\n    setRefreshTokenState(refresh);\n    setAccessToken(access);\n    setRefreshToken(refresh);\n  };\n  const removeTokens = useCallback(() => {\n    setAccessTokenState(null);\n    setRefreshTokenState(null);\n    removeAccessToken();\n    removeRefreshToken();\n    setUser(null);\n    setIsAdmin(false);\n  }, []);\n  const fetchUserData = useCallback(async access => {\n    try {\n      const response = await fetch('/api/is_admin/', {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${access}`\n        }\n      });\n      if (!response.ok) {\n        throw new Error('Failed to fetch user data');\n      }\n      const data = await response.json();\n      setIsAdmin(data.is_admin);\n      setUser(data);\n    } catch (error) {\n      console.error('Error fetching user data:', error);\n      removeTokens();\n    } finally {\n      setLoading(false);\n    }\n  }, [removeTokens]);\n  useEffect(() => {\n    console.log('useEffect запущен, accessToken:', accessToken);\n    if (accessToken) {\n      fetchUserData(accessToken);\n    } else {\n      setLoading(false);\n    }\n  }, [accessToken, fetchUserData]);\n  const contextData = {\n    accessToken,\n    refreshToken,\n    user,\n    isAdmin,\n    setTokens,\n    removeTokens,\n    loading\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextData,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthProvider, \"VQIdXo7RiPJzeB4rTgAMXZkKJSE=\");\n_c = AuthProvider;\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","useCallback","getRefreshToken","setRefreshToken","removeRefreshToken","getAccessToken","setAccessToken","removeAccessToken","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","accessToken","setAccessTokenState","refreshToken","setRefreshTokenState","user","setUser","isAdmin","setIsAdmin","loading","setLoading","setTokens","access","refresh","removeTokens","fetchUserData","response","fetch","method","headers","ok","Error","data","json","is_admin","error","console","log","contextData","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/МИРЭА/workout-manager/fitness-client/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useCallback } from 'react';\nimport { getRefreshToken, setRefreshToken, removeRefreshToken, getAccessToken, setAccessToken, removeAccessToken } from '../utils/api';\n\nconst AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n    const [accessToken, setAccessTokenState] = useState(getAccessToken());\n    const [refreshToken, setRefreshTokenState] = useState(getRefreshToken());\n    const [user, setUser] = useState(null);\n    const [isAdmin, setIsAdmin] = useState(false);\n    const [loading, setLoading] = useState(true);\n\n    const setTokens = (access, refresh) => {\n        setAccessTokenState(access);\n        setRefreshTokenState(refresh);\n        setAccessToken(access);\n        setRefreshToken(refresh);\n    }\n\n    const removeTokens = useCallback(() => {\n        setAccessTokenState(null);\n        setRefreshTokenState(null);\n        removeAccessToken();\n        removeRefreshToken();\n        setUser(null);\n        setIsAdmin(false);\n    }, []);\n\n    const fetchUserData = useCallback(async (access) => {\n        try {\n            const response = await fetch('/api/is_admin/', {\n                method: 'GET',\n                headers: {\n                    'Authorization': `Bearer ${access}`,\n                },\n            });\n            if (!response.ok) {\n                throw new Error('Failed to fetch user data');\n            }\n            const data = await response.json();\n            setIsAdmin(data.is_admin);\n            setUser(data);\n        } catch (error) {\n            console.error('Error fetching user data:', error);\n            removeTokens();\n        } finally {\n            setLoading(false);\n        }\n    }, [removeTokens]);\n\n    useEffect(() => {\n        console.log('useEffect запущен, accessToken:', accessToken);\n        if (accessToken) {\n            fetchUserData(accessToken);\n        } else {\n            setLoading(false);\n        }\n    }, [accessToken, fetchUserData]);\n\n    const contextData = {\n        accessToken,\n        refreshToken,\n        user,\n        isAdmin,\n        setTokens,\n        removeTokens,\n        loading,\n    };\n\n    return (\n        <AuthContext.Provider value={contextData}>\n            {children}\n        </AuthContext.Provider>\n    );\n};\n\nexport default AuthContext;\n\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,QAAQ,EAAEC,SAAS,EAAEC,WAAW,QAAQ,OAAO;AAC9E,SAASC,eAAe,EAAEC,eAAe,EAAEC,kBAAkB,EAAEC,cAAc,EAAEC,cAAc,EAAEC,iBAAiB,QAAQ,cAAc;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEvI,MAAMC,WAAW,gBAAGZ,aAAa,CAAC,CAAC;AAEnC,OAAO,MAAMa,YAAY,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,EAAA;EAC1C,MAAM,CAACC,WAAW,EAAEC,mBAAmB,CAAC,GAAGhB,QAAQ,CAACM,cAAc,CAAC,CAAC,CAAC;EACrE,MAAM,CAACW,YAAY,EAAEC,oBAAoB,CAAC,GAAGlB,QAAQ,CAACG,eAAe,CAAC,CAAC,CAAC;EACxE,MAAM,CAACgB,IAAI,EAAEC,OAAO,CAAC,GAAGpB,QAAQ,CAAC,IAAI,CAAC;EACtC,MAAM,CAACqB,OAAO,EAAEC,UAAU,CAAC,GAAGtB,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAACuB,OAAO,EAAEC,UAAU,CAAC,GAAGxB,QAAQ,CAAC,IAAI,CAAC;EAE5C,MAAMyB,SAAS,GAAGA,CAACC,MAAM,EAAEC,OAAO,KAAK;IACnCX,mBAAmB,CAACU,MAAM,CAAC;IAC3BR,oBAAoB,CAACS,OAAO,CAAC;IAC7BpB,cAAc,CAACmB,MAAM,CAAC;IACtBtB,eAAe,CAACuB,OAAO,CAAC;EAC5B,CAAC;EAED,MAAMC,YAAY,GAAG1B,WAAW,CAAC,MAAM;IACnCc,mBAAmB,CAAC,IAAI,CAAC;IACzBE,oBAAoB,CAAC,IAAI,CAAC;IAC1BV,iBAAiB,CAAC,CAAC;IACnBH,kBAAkB,CAAC,CAAC;IACpBe,OAAO,CAAC,IAAI,CAAC;IACbE,UAAU,CAAC,KAAK,CAAC;EACrB,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMO,aAAa,GAAG3B,WAAW,CAAC,MAAOwB,MAAM,IAAK;IAChD,IAAI;MACA,MAAMI,QAAQ,GAAG,MAAMC,KAAK,CAAC,gBAAgB,EAAE;QAC3CC,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UACL,eAAe,EAAE,UAAUP,MAAM;QACrC;MACJ,CAAC,CAAC;MACF,IAAI,CAACI,QAAQ,CAACI,EAAE,EAAE;QACd,MAAM,IAAIC,KAAK,CAAC,2BAA2B,CAAC;MAChD;MACA,MAAMC,IAAI,GAAG,MAAMN,QAAQ,CAACO,IAAI,CAAC,CAAC;MAClCf,UAAU,CAACc,IAAI,CAACE,QAAQ,CAAC;MACzBlB,OAAO,CAACgB,IAAI,CAAC;IACjB,CAAC,CAAC,OAAOG,KAAK,EAAE;MACZC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjDX,YAAY,CAAC,CAAC;IAClB,CAAC,SAAS;MACNJ,UAAU,CAAC,KAAK,CAAC;IACrB;EACJ,CAAC,EAAE,CAACI,YAAY,CAAC,CAAC;EAElB3B,SAAS,CAAC,MAAM;IACZuC,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAE1B,WAAW,CAAC;IAC3D,IAAIA,WAAW,EAAE;MACbc,aAAa,CAACd,WAAW,CAAC;IAC9B,CAAC,MAAM;MACHS,UAAU,CAAC,KAAK,CAAC;IACrB;EACJ,CAAC,EAAE,CAACT,WAAW,EAAEc,aAAa,CAAC,CAAC;EAEhC,MAAMa,WAAW,GAAG;IAChB3B,WAAW;IACXE,YAAY;IACZE,IAAI;IACJE,OAAO;IACPI,SAAS;IACTG,YAAY;IACZL;EACJ,CAAC;EAED,oBACIb,OAAA,CAACC,WAAW,CAACgC,QAAQ;IAACC,KAAK,EAAEF,WAAY;IAAA7B,QAAA,EACpCA;EAAQ;IAAAgC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACS,CAAC;AAE/B,CAAC;AAAClC,EAAA,CArEWF,YAAY;AAAAqC,EAAA,GAAZrC,YAAY;AAuEzB,eAAeD,WAAW;AAAC,IAAAsC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}